# 仕様書

## 1. システム概要

### 1.1 目的
社員のスキル・経験情報を一元管理し、スキルシート（帳票）を効率的に作成できるタレントマネジメントシステム。

### 1.2 対象ユーザー
- 自社社員（全員がシステムを利用可能）
- M365契約による認証でアクセス制限

---

## 2. 機能一覧

| No | 機能名 | 概要 |
|----|--------|------|
| F-01 | 社員情報管理 | 社員の基本情報・業務経験・資格・知識を登録・編集・閲覧する |
| F-02 | スキルシート出力 | 社員情報からHTML帳票を生成し、PDF出力できる |
| F-03 | 認証 | M365認証（Microsoft Entra ID）またはemail/password認証でログイン |
| F-04 | 権限管理 | ユーザーの権限に応じたアクセス制御 |

---

## 3. 画面一覧

| No | 画面名 | 概要 | 対象権限 |
|----|--------|------|----------|
| S-01 | ログイン画面 | M365またはemail/passwordでログイン | 全員 |
| S-02 | ダッシュボード | ログイン後のホーム画面 | 全員 |
| S-03 | 社員一覧画面 | 社員の一覧表示・検索 | 上長・営業・管理者 |
| S-04 | 社員詳細画面 | 社員情報の詳細表示 | 全員（権限に応じた範囲） |
| S-05 | 社員編集画面 | 社員情報の編集 | 全員（権限に応じた範囲） |
| S-06 | スキルシート画面 | HTML帳票表示・PDF出力 | 全員（権限に応じた範囲） |

### 3.1 社員一覧画面の検索・フィルタ機能

#### 検索条件
| 項目 | 検索方式 |
|------|----------|
| 氏名 | 部分一致 |
| 所属（組織） | 選択式（配下組織含む） |
| スキル | 複数選択可（AND/OR切替） |
| 資格 | 複数選択可（AND/OR切替） |
| 業務種別 | 複数選択可 |
| 業務範囲 | 複数選択可 |
| 在籍状況 | 在籍のみ / 退職含む（管理者のみ） |

#### 表示項目
- 氏名
- 所属
- 役職
- 業界経験年数
- 主なスキル（上位3件）

#### ソート
- 氏名（五十音順）
- 入社日
- 業界経験年数

---

## 4. 管理データ項目

### 4.1 基本情報
| 項目名 | 説明 | 必須 |
|--------|------|------|
| 氏名 | 社員の氏名 | ○ |
| 年齢 | 社員の年齢（または生年月日から算出） | ○ |
| 入社日 | 会社への入社日 | ○ |
| 業界経験年数 | IT業界等での経験年数 | ○ |
| 所属 | 所属部署（組織マスタから選択） | ○ |
| 役職 | 現在の役職 | - |
| 在籍状況 | 在籍 / 退職 | ○ |
| 退職日 | 退職した日付（在籍中は空） | - |

### 4.2 業務経験（複数登録可）

#### 期間
| 項目名 | 説明 | 必須 |
|--------|------|------|
| 開始日 | 業務の開始日 | ○ |
| 終了日 | 業務の終了日（現在進行中は空） | - |

#### 業務先
| 項目名 | 説明 | 必須 |
|--------|------|------|
| 業務先名 | 案件名やプロジェクト名など業務を識別する名称 | ○ |

#### 契約先
| 項目名 | 説明 | 必須 |
|--------|------|------|
| 契約先会社名 | 契約元の会社名 | ○ |
| 契約方式 | 請負 / 準委任 / 派遣 | ○ |

#### 勤務先
| 項目名 | 説明 | 必須 |
|--------|------|------|
| 勤務先会社名 | 実際の勤務先会社名 | ○ |
| 勤務先部署名 | 勤務先の部署名 | - |

#### 業務内容
| 項目名 | 説明 | 必須 |
|--------|------|------|
| 業務種別 | 構築 / 運用保守 / サービスデスク / PMO | ○ |
| 業務概要 | 業務内容の概要説明 | ○ |
| 業務範囲 | 要件定義 / 設計 / 構築 / テスト / 保守（複数選択可） | ○ |
| 利用スキル | 使用した技術・ツール（複数登録可） | - |

### 4.3 資格（複数登録可）
| 項目名 | 説明 | 必須 |
|--------|------|------|
| 資格名 | 取得した資格の名称 | ○ |
| 取得日 | 資格を取得した日付 | ○ |

### 4.4 知識・スキル（複数登録可）
| 項目名 | 説明 | 必須 |
|--------|------|------|
| プログラミング言語 | 業務経験はないが理解できる言語 | - |

### 4.5 マスタデータ

スキル・資格は「ハイブリッド方式」で管理する。マスタから選択しつつ、新規追加も可能。

#### スキルマスタ
| 項目名 | 説明 | 必須 |
|--------|------|------|
| スキルID | スキルを一意に識別するID | ○ |
| スキル名 | スキルの名称（例：Java, AWS, Docker） | ○ |
| カテゴリ | スキルの分類（例：言語, クラウド, ツール） | - |

#### 資格マスタ
| 項目名 | 説明 | 必須 |
|--------|------|------|
| 資格ID | 資格を一意に識別するID | ○ |
| 資格名 | 資格の正式名称 | ○ |
| 略称 | 資格の略称（例：AWS SAA） | - |
| 発行機関 | 資格の発行機関 | - |

#### 入力方式
- マスタに登録済みのスキル・資格は選択式で入力
- マスタにない場合は自由入力で新規追加可能
- 新規追加されたものは管理者がマスタに正式登録可能

---

## 5. 組織管理

### 5.1 組織階層
組織は階層構造で管理し、上長は自身が管理する組織配下の社員情報を閲覧できる。

```
例：
本部
├── 総務部
├── 営業部
├── 第一事業部
│   ├── 一課
│   └── 二課
└── 第二事業部
    └── 一課
```

### 5.2 組織マスタ
| 項目名 | 説明 | 必須 |
|--------|------|------|
| 組織ID | 組織を一意に識別するID | ○ |
| 組織名 | 組織の名称 | ○ |
| 親組織ID | 上位組織のID（最上位はnull） | - |
| 組織長 | 当該組織の長となる社員 | - |

### 5.3 配下の定義
- 上長権限を持つ社員は、自身が「組織長」として設定された組織およびその配下組織に所属する社員の情報を閲覧できる
- 組織階層は再帰的に辿り、すべての子孫組織の社員が閲覧対象となる

---

## 6. 社員管理

### 6.1 社員登録
| 登録方法 | 説明 |
|----------|------|
| 管理者による手動登録 | 管理者が社員情報を入力して登録 |
| M365初回ログイン時の自動登録 | M365認証で初回ログイン時に社員レコードを自動作成 |

#### M365自動登録時の初期値
- 氏名：M365のアカウント名から取得
- メールアドレス：M365のメールアドレスから取得
- その他の項目：空（初回ログイン後に本人が入力）

### 6.2 初期管理ユーザー

システム導入時に初期管理ユーザーを必ず作成する。

#### 作成タイミング
- データベースマイグレーション実行時（シード処理）

#### 初期管理ユーザーの設定
| 項目 | 値 |
|------|------|
| 認証方式 | email/password |
| メールアドレス | `admin@example.com`（固定値） |
| 初期パスワード | `admin`（固定値） |
| 権限 | 管理者 |
| 氏名 | 「システム管理者」 |

#### 運用上の注意
- 初期パスワードは初回ログイン後に必ず変更すること
- 別の管理者ユーザーを作成後、初期管理ユーザーは無効化（退職扱い）可能
- 最低1名の管理者が存在する状態を維持すること（システムで制御）

### 6.3 退職者の扱い
| 項目 | 内容 |
|------|------|
| 削除方式 | 論理削除（在籍状況を「退職」に変更） |
| 表示 | 社員一覧・検索結果にはデフォルト非表示 |
| フィルタ | 管理者は退職者を含めた検索が可能 |
| データ保持 | 退職後もデータは保持される |
| ログイン | 退職者はログイン不可 |

---

## 7. ユーザー権限

### 7.1 権限種別
| 権限名 | 説明 |
|--------|------|
| 一般 | 自分自身の情報のみ閲覧・編集可能 |
| 上長 | 一般権限 + 配下社員の情報を閲覧可能 |
| 営業 | 一般権限 + 全社員の情報を閲覧可能 |
| 管理者 | 全社員の情報を閲覧・編集可能 |

### 7.2 権限マトリクス

| 操作 | 一般 | 上長 | 営業 | 管理者 |
|------|------|------|------|--------|
| 自分の情報閲覧 | ○ | ○ | ○ | ○ |
| 自分の情報編集 | ○ | ○ | ○ | ○ |
| 配下社員の情報閲覧 | - | ○ | - | ○ |
| 配下社員の情報編集 | - | - | - | ○ |
| 全社員の情報閲覧 | - | - | ○ | ○ |
| 全社員の情報編集 | - | - | - | ○ |
| 社員一覧画面アクセス | - | ○ | ○ | ○ |
| スキルシート出力（自分） | ○ | ○ | ○ | ○ |
| スキルシート出力（他者） | - | ○ | ○ | ○ |

---

## 8. スキルシート出力

### 8.1 出力形式
- HTML形式で帳票を画面表示
- ブラウザの印刷機能を使用してPDF出力

### 8.2 出力内容
- 基本情報
- 業務経験一覧
- 資格一覧
- 知識・スキル一覧

---

## 9. 認証

### 9.1 認証方式
| 方式 | 説明 |
|------|------|
| Microsoft Entra ID（M365） | 会社のM365アカウントでSSO認証 |
| email/password | メールアドレスとパスワードによる認証 |

### 9.2 認証フロー
1. ログイン画面で認証方式を選択
2. 選択した方式で認証処理
3. 認証成功後、ダッシュボードへ遷移
4. 権限情報を取得し、アクセス制御を適用

---

## 10. 非機能要件

### 10.1 技術スタック
| 項目 | 技術 |
|------|------|
| フレームワーク | Next.js 16 (App Router) |
| 言語 | TypeScript |
| スタイリング | Tailwind CSS v4 + shadcn/ui |
| データベース | PostgreSQL + Drizzle ORM |
| 認証 | better-auth + Microsoft Entra ID |

### 10.2 インフラ構成（AWS）

#### 構成図
```
┌─────────────────────────────────────────────────────────┐
│                        AWS                              │
│  ┌─────────────┐     ┌─────────────┐     ┌───────────┐ │
│  │   Route 53  │────▶│  App Runner │────▶│    RDS    │ │
│  │  (DNS/SSL)  │     │  (Next.js)  │     │(PostgreSQL)│ │
│  └─────────────┘     └─────────────┘     └───────────┘ │
│                             │                           │
│                      ┌──────┴──────┐                    │
│                      │     ECR     │                    │
│                      │ (Container) │                    │
│                      └─────────────┘                    │
└─────────────────────────────────────────────────────────┘
```

#### サービス構成
| コンポーネント | サービス | 開発環境 | 本番環境 |
|----------------|----------|----------|----------|
| アプリケーション | App Runner | 0.25 vCPU / 0.5GB | 0.5 vCPU / 1GB |
| データベース | RDS PostgreSQL | db.t4g.micro | db.t4g.small |
| コンテナレジストリ | ECR | 共用 | 共用 |
| DNS/SSL | Route 53 + ACM | - | ○ |

#### 環境構成
| 環境 | 用途 | URL（例） |
|------|------|-----------|
| 開発 | 開発・テスト用 | dev.example.com |
| 本番 | 本番運用 | app.example.com |

#### 月額コスト概算
| 項目 | 開発環境 | 本番環境 |
|------|----------|----------|
| App Runner | $5〜10 | $15〜25 |
| RDS | $15 | $25 |
| ECR | $1 | $1 |
| Route 53 | - | $1 |
| **合計** | **$20〜25** | **$40〜50** |

※ 利用状況により変動

### 10.3 セキュリティ要件
- 認証済みユーザーのみアクセス可能
- 権限に応じたデータアクセス制御
- HTTPS通信必須（ACM証明書）
- セッション管理による不正アクセス防止
- RDSはプライベートサブネットに配置
- App RunnerからRDSへのアクセスはVPCコネクタ経由

### 10.4 デプロイ
| 項目 | 内容 |
|------|------|
| CI/CD | GitHub Actions |
| デプロイ方式 | mainブランチへのpushで自動デプロイ |
| コンテナビルド | GitHub Actions → ECR → App Runner |
| マイグレーション | デプロイ時に自動実行 |
